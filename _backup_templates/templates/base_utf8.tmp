<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>{% block title %}ResQFood{% endblock %}</title>
  {% load static %}
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#fff; --text:#111; --muted:#666; --brand:#e60023; }
    body { margin:0; background:var(--bg); color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, 'Apple Color Emoji', 'Segoe UI Emoji'; }
    .container{ max-width:1200px; margin:0 auto; padding:0 16px; }
    .nav{ position:sticky; top:0; background:#fff; border-bottom:1px solid #eee; z-index:10 }
    .nav-inner{ display:flex; gap:12px; align-items:center; height:64px }
    .logo{ display:flex; align-items:center; gap:8px; font-weight:800; font-size:20px; color:var(--brand);
      text-decoration:none; margin-right:24px; }
    .chip{ display:inline-flex; gap:8px; align-items:center; border:1px solid #eee; border-radius:999px; padding:8px 12px;
      background:#fafafa; cursor:pointer }
    .searchbar{ flex:1; display:flex; align-items:center; border:1px solid #eee; border-radius:999px; padding:8px 12px; gap:8px }
    .searchbar input{ border:none; outline:none; flex:1; font-size:14px }
    .btn{ border:1px solid #eee; border-radius:10px; padding:8px 12px; background:#fff; cursor:pointer }
    .section{ padding:24px 0 } .section h2{ margin:0 0 12px 0 }
    .scroll-x{ display:flex; gap:12px; overflow:auto; padding-bottom:4px; scrollbar-width:thin }
    .card{ min-width:280px; border:1px solid #eee; border-radius:12px; overflow:hidden; background:#fff }
    .card img{ width:100%; height:150px; object-fit:cover; display:block }
    .card .p{ padding:12px } .pill{ display:inline-block; padding:2px 8px; border-radius:999px; background:#f3f4f6; color:#111; font-size:12px }
    .price{ font-weight:800 } .line{ color:#999; text-decoration:line-through; margin-right:6px }
    .grid-chips{ display:flex; flex-wrap:wrap; gap:8px }
    @media (max-width:768px){ .card{ min-width:220px } }
    :root{ --card-bg:#fff; --card-bd:#e5e7eb; --card-r:14px; --muted:#6b7280; --ink:#111827; --brand:#2563eb;
      --ok:#10b981; --warn:#f59e0b; --err:#ef4444; --shadow:0 6px 22px rgba(0,0,0,.08); }
    .card{ background:var(--card-bg); border:1px solid var(--card-bd); border-radius:var(--card-r); overflow:hidden;
      transition:transform .08s ease, box-shadow .2s ease, border-color .2s ease; will-change:transform,box-shadow; }
    .card:hover{ transform:translateY(-2px); box-shadow:var(--shadow); border-color:#d1d5db }
    .card-body{ padding:10px 12px } .title{ font-weight:700; color:var(--ink); margin:0 0 4px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
    .meta{ color:var(--muted); font-size:.92rem; display:flex; justify-content:space-between; gap:8px; align-items:center }
    .price{ color:var(--ink); font-weight:800; letter-spacing:.1px }
    .price s{ color:#9ca3af; font-weight:500; margin-left:6px }
    .thumb{ width:100%; display:block; background:#f3f4f6; border-bottom:1px solid var(--card-bd); aspect-ratio:4/3; object-fit:cover }
    .logo{ width:72px; height:72px; border-radius:12px; background:#f3f4f6; object-fit:cover }
    .badge{ font-size:.85rem; border-radius:999px; padding:4px 8px; border:1px solid var(--card-bd) }
    .b-ok{ background:#ecfdf5; border-color:#86efac } .b-warn{ background:#fffbeb; border-color:#fde68a }
    .b-err{ background:#fef2f2; border-color:#fecaca }
    a.link{ text-decoration:none; color:inherit; display:block }
    :where(a,button,select,input):focus-visible{ outline:2px solid var(--brand); outline-offset:2px; border-radius:8px }
    .skeleton{ position:relative; overflow:hidden; background:#f3f4f6 }
    .skeleton::after{ content:""; position:absolute; inset:0; transform:translateX(-100%);
      background:linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.45) 50%, rgba(255,255,255,0) 100%); animation:sheen 1.2s infinite }
    @keyframes sheen{ 100%{ transform:translateX(100%)} }
  </style>
  <script>
    // Fallback de im치genes
    window.addEventListener('error', function(e){
      if (e.target && e.target.tagName === 'IMG'){
        const img = e.target;
        if (!img.dataset.fallback){
          img.dataset.fallback = '1';
          const ph = img.getAttribute('data-placeholder') || "{% static 'img/placeholder-pack.jpg' %}";
          img.src = ph;
        }
      }
    }, true);
  </script>
</head>
<body>
  <header class="nav">
    <div class="container nav-inner">
      <a class="logo" href="{% url 'home' %}">ResQFood</a>

      <button class="chip" id="btn-ubicacion">游늸 <span id="ubicacion-label">Elegir ubicaci칩n</span></button>

      <form class="searchbar" action="{% url 'search' %}" method="get">
        <input type="search" id="q" name="q" placeholder="Buscar packs o comercios..." />
        <button class="btn" type="submit">Buscar</button>
      </form>

      <div style="display:flex; gap:8px; margin-left:auto;">
        {% if user.is_authenticated %}
          <span style="font-size:14px;color:#666;">Hola, {{ user.username }}</span>
          <form action="{% url 'logout' %}" method="post" style="display:inline">
            {% csrf_token %}
            <a href="{% url 'cart' %}">Mi Carrito <span id="cart-badge" class="pill">{{ cart_count|default:0 }}</span></a>
            <button class="btn" type="submit">Salir</button>
          </form>
        {% else %}
          <a class="btn" href="{% url 'login' %}?next={{ request.path }}">Ingresar</a>
          <a class="btn" href="{% url 'signup' %}">Registrarse</a>
        {% endif %}
      </div>
    </div>
  </header>

  <main class="container">
    {% if messages %}
      <div class="container" style="margin:12px 0">
        {% for message in messages %}
          <div style="padding:8px 12px; border:1px solid #eee; border-left:4px solid #2d6; border-radius:8px; margin-bottom:6px;">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    {% block content %}{% endblock %}
  </main>

  <script>
    // Ubicaci칩n simple (localStorage)
    const ubicKey = "rf_ubicacion";
    const label = document.getElementById("ubicacion-label");
    const guardada = localStorage.getItem(ubicKey);
    if (guardada) label.textContent = guardada;

    document.getElementById("btn-ubicacion").onclick = () => {
      const nueva = prompt("쮻칩nde est치s? (ej: Buenos Aires)");
      if (nueva) { localStorage.setItem(ubicKey, nueva); label.textContent = nueva; }
    };
  </script>

  <script>
    function updateCartBadge(n){
      var el = document.getElementById('cart-badge');
      if (el){ el.textContent = n; }
    }
  </script>

  <form style="display:none">{% csrf_token %}</form>
</body>
</html>
