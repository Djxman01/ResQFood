<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>{% block title %}ResQFood{% endblock %}</title>
  {% load static %}
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#f7fbea; --text:#111; --muted:#666; --brand:#22c55e; }
    html, body{ height:100%; }
    body { margin:0; background:var(--bg); color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, 'Apple Color Emoji', 'Segoe UI Emoji';
      min-height:100vh; display:flex; flex-direction:column; }
    main{ flex:1; }
    .container{ max-width:1200px; margin:0 auto; padding:0 16px; }
    .nav{ position:sticky; top:0; background:#fff; border-bottom:1px solid #eee; z-index:10 }
    .nav-inner{ display:flex; gap:12px; align-items:center; height:64px }
    .logo{ display:flex; align-items:center; gap:8px; font-weight:800; font-size:20px; color:var(--brand); text-decoration:none; margin-right:24px; }
    .chip{ display:inline-flex; gap:8px; align-items:center; border:1px solid #eee; border-radius:999px; padding:8px 12px; background:#fafafa; cursor:pointer }
    .searchbar{ flex:1; display:flex; align-items:center; border:1px solid #eee; border-radius:999px; padding:8px 12px; gap:8px }
    .searchbar input{ border:none; outline:none; flex:1; font-size:14px }
    .btn{ border:1px solid var(--brand); border-radius:10px; padding:8px 12px; background:var(--brand); color:#fff; cursor:pointer; font-weight:700; text-decoration:none; display:inline-block }
    .btn:hover{ filter:brightness(0.95) }
    .icon-btn{ width:40px; height:40px; padding:0; display:inline-flex; align-items:center; justify-content:center; background:#fff; color:var(--brand); border-color:var(--brand) }
    .icon-btn:hover{ background:#f8fff9 }
    .section{ padding:24px 0 } .section h2{ margin:0 0 12px 0 }
    .scroll-x{ display:flex; gap:12px; overflow:auto; padding-bottom:4px; scrollbar-width:thin }
    .card{ min-width:280px; border:1px solid #eee; border-radius:12px; overflow:hidden; background:#fff }
    .card img{ width:100%; height:150px; object-fit:cover; display:block }
    .card .p{ padding:12px } .pill{ display:inline-block; padding:2px 8px; border-radius:999px; background:#f3f4f6; color:#111; font-size:12px }
    .price{ font-weight:800 } .line{ color:#999; text-decoration:line-through; margin-right:6px }
    .grid-chips{ display:flex; flex-wrap:wrap; gap:8px }
    @media (max-width:768px){ .card{ min-width:220px } }
    :root{ --card-bg:#fff; --card-bd:#e5e7eb; --card-r:14px; --muted:#6b7280; --ink:#111827; --brand:#22c55e;
      --ok:#10b981; --warn:#f59e0b; --err:#ef4444; --shadow:0 6px 22px rgba(0,0,0,.08); }
    .card{ background:var(--card-bg); border:1px solid var(--card-bd); border-radius:var(--card-r); overflow:hidden;
      transition:transform .08s ease, box-shadow .2s ease, border-color .2s ease; will-change:transform,box-shadow; }
    .card:hover{ transform:translateY(-2px); box-shadow:var(--shadow); border-color:#d1d5db }
    .card-body{ padding:10px 12px } .title{ font-weight:700; color:var(--ink); margin:0 0 4px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
    .meta{ color:var(--muted); font-size:.92rem; display:flex; justify-content:space-between; gap:8px; align-items:center }
    .price{ color:var(--ink); font-weight:800; letter-spacing:.1px }
    .price s{ color:#9ca3af; font-weight:500; margin-left:6px }
    .thumb{ width:100%; display:block; background:#f3f4f6; border-bottom:1px solid var(--card-bd); aspect-ratio:4/3; object-fit:cover }
    .badge{ font-size:.85rem; border-radius:999px; padding:4px 8px; border:1px solid var(--card-bd) }
    .b-ok{ background:#ecfdf5; border-color:#86efac } .b-warn{ background:#fffbeb; border-color:#fde68a }
    .b-err{ background:#fef2f2; border-color:#fecaca }
    a.link{ text-decoration:none; color:inherit; display:block }
    :where(a,button,select,input):focus-visible{ outline:2px solid var(--brand); outline-offset:2px; border-radius:8px }
    .skeleton{ position:relative; overflow:hidden; background:#f3f4f6 }
    .skeleton::after{ content:""; position:absolute; inset:0; transform:translateX(-100%);
      background:linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.45) 50%, rgba(255,255,255,0) 100%); animation:sheen 1.2s infinite }
    @keyframes sheen{ 100%{ transform:translateX(100%)} }

    /* Footer */
    .footer{ margin-top:24px; background:#fff; border-top:1px solid #eee; }
    .footer-inner{ display:grid; gap:16px; grid-template-columns: repeat(2, 1fr); padding:24px 0; }
    @media (min-width:768px){ .footer-inner{ grid-template-columns: repeat(4, 1fr); } }
    .f-title{ font-weight:800; margin-bottom:8px; color: var(--brand); }
    .f-text{ color:#6b7280; margin:0; }
    .f-links{ display:flex; flex-direction:column; gap:6px; }
    .footer a{ text-decoration:none; color:inherit; }
    .footer a:hover{ text-decoration:none; }
    .footer-copy{ text-align:center; color:#6b7280; padding:12px 0; border-top:1px solid #f3f4f6; font-size:.9rem; }
  </style>
  <script>
    // Fallback de im谩genes
    window.addEventListener('error', function(e){
      if (e.target && e.target.tagName === 'IMG'){
        const img = e.target;
        if (!img.dataset.fallback){
          img.dataset.fallback = '1';
          const ph = img.getAttribute('data-placeholder') || "{% static 'img/placeholder-pack.svg' %}";
          img.src = ph;
        }
      }
    }, true);
  </script>
</head>
<body>
  <header class="nav">
    <div class="container nav-inner">
      <a class="logo" href="{% url 'home' %}">ResQFood</a>

      <button class="chip" id="btn-ubicacion" type="button" aria-label="Elegir ubicaci贸n">
        <span style="display:inline-flex;align-items:center;gap:6px;">
          <span></span>
          <span id="ubicacion-label">Elegir ubicaci贸n</span>
        </span>
      </button>

      <form class="searchbar" action="{% url 'search' %}" method="get">
        <input type="search" id="q" name="q" placeholder="Buscar packs o comercios..." />
        <button class="btn" type="submit">Buscar</button>
      </form>

      <div style="display:flex; gap:8px; margin-left:auto; align-items:center;">
        {% if user.is_authenticated %}
          <a class="btn icon-btn" href="{% url 'mi_cuenta' %}" aria-label="Mi cuenta" title="Mi cuenta">
            <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" fill="currentColor"><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10Zm0 2c-4.97 0-8 2.239-8 4v2h16v-2c0-1.761-3.03-4-8-4Z"/></svg>
          </a>
          <a class="btn icon-btn" href="{% url 'my_orders' %}" aria-label="Mis pedidos" title="Mis pedidos">
            <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" fill="currentColor"><path d="M6 3h12a2 2 0 0 1 2 2v14l-4-2-4 2-4-2-4 2V5a2 2 0 0 1 2-2Z" opacity=".15"/><path d="M6 3h12a2 2 0 0 1 2 2v14l-4-2-4 2-4-2-4 2V5a2 2 0 0 1 2-2Zm0 2v11.382l2-.999 4 2 4-2 2 1V5H6Z"/></svg>
          </a>
          <a class="btn icon-btn" href="{% url 'cart' %}" aria-label="Mi carrito" title="Mi carrito" style="position:relative;">
            <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" fill="currentColor"><path d="M7 4h-2l-1 2v1h2l3.6 7.59-1.35 2.45A1 1 0 0 0 9.8 19h9.4v-2H10.62l.9-1.63h6.68a1 1 0 0 0 .92-.62l3-7A1 1 0 0 0 21.2 6H7.42L7 5.2V4Z"/></svg>
            <span id="cart-badge" class="pill" style="position:absolute; top:-6px; right:-6px; background:#fff; color:var(--brand); border-color:#fff; font-weight:700;">{{ cart_count|default:0 }}</span>
          </a>
          <form action="{% url 'logout' %}" method="post" style="display:inline">
            {% csrf_token %}
            <button class="btn icon-btn" type="submit" aria-label="Salir de la cuenta" title="Salir">
              <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" fill="currentColor"><path d="M10 3a2 2 0 0 0-2 2v4h2V5h8v14h-8v-4H8v4a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-8Z"/><path d="M11 12H4m0 0 3-3m-3 3 3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>
            </button>
          </form>
        {% else %}
          <a class="btn" href="{% url 'login' %}?next={{ request.path }}">Ingresar</a>
          <a class="btn" href="{% url 'signup' %}">Registrarse</a>
        {% endif %}
      </div>
    </div>
  </header>

  <main class="container">
    {% if messages %}
      <div class="container" style="margin:12px 0">
        {% for message in messages %}
          <div style="padding:8px 12px; border:1px solid #eee; border-left:4px solid #2d6; border-radius:8px; margin-bottom:6px;">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    {% block content %}{% endblock %}
  </main>

  <script>
    // Ubicaci贸n simple (localStorage)
    const ubicKey = "rf_ubicacion";
    const label = document.getElementById("ubicacion-label");
    const guardada = localStorage.getItem(ubicKey);
    if (guardada) label.textContent = guardada;

    document.getElementById("btn-ubicacion").onclick = () => {
      const nueva = prompt("驴D贸nde est谩s? (ej: C贸rdoba)");
      if (nueva) { localStorage.setItem(ubicKey, nueva); label.textContent = nueva; }
    };
  </script>

  <script>
    function updateCartBadge(n){
      var el = document.getElementById('cart-badge');
      if (el){ el.textContent = n; }
    }
  </script>

  <form style="display:none">{% csrf_token %}</form>

  <footer class="footer">
    <div class="container footer-inner">
      <div>
        <div class="f-title">ResQFood</div>
        <p class="f-text">Conectamos comercios con personas para aprovechar packs con descuento y evitar desperdicios.</p>
      </div>
      <div>
        <div class="f-title">Ayuda</div>
        <div class="f-links">
          <a href="/packs/">Ver packs</a>
          <a href="{% url 'my_orders' %}">Mis pedidos</a>
          <a href="{% url 'cart' %}">Mi carrito</a>
        </div>
      </div>
      <div>
        <div class="f-title">Cuenta</div>
        <div class="f-links">
          {% if user.is_authenticated %}
            <a href="{% url 'mi_cuenta' %}">Mi cuenta</a>
            <a href="{% url 'logout' %}">Cerrar sesi贸n</a>
          {% else %}
            <a href="{% url 'login' %}">Ingresar</a>
            <a href="{% url 'signup' %}">Registrarse</a>
          {% endif %}
        </div>
      </div>
      <div>
        <div class="f-title">Legal</div>
        <div class="f-links">
          <a href="#">T茅rminos y condiciones</a>
          <a href="#">Pol铆tica de privacidad</a>
        </div>
      </div>
    </div>
    <div class="container footer-copy">漏 {% now "Y" %} ResQFood</div>
  </footer>
</body>
</html>


